<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Anamnese Odontológica - Dra. Jaqueline Nobre Moratore</title>
    
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        /* Modern Pink/White Color Palette */
        :root {
            --primary-pink: #e91e63;
            --light-pink: #fce4ec;
            --soft-pink: #f8bbd9;
            --dark-pink: #c2185b;
            --white: #ffffff;
            --light-gray: #f5f5f5;
            --medium-gray: #e0e0e0;
            --dark-gray: #616161;
            --text-dark: #212121;
            --success-green: #4caf50;
            --error-red: #f44336;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Poppins', sans-serif;
            line-height: 1.6;
            color: var(--text-dark);
            background: linear-gradient(135deg, var(--light-pink) 0%, var(--white) 100%);
            min-height: 100vh;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }

        .header {
            background: var(--white);
            box-shadow: 0 2px 15px rgba(233, 30, 99, 0.1);
            padding: 1.5rem 0;
            position: sticky;
            top: 0;
            z-index: 1000;
        }

        .logo-container {
            display: flex;
            align-items: center;
            gap: 1.5rem;
        }

        .logo {
            height: 80px;
            width: auto;
            border-radius: 10px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        .clinic-info h1 {
            color: var(--dark-pink);
            font-size: 1.8rem;
            font-weight: 600;
            margin-bottom: 0.3rem;
        }

        .specialty {
            color: var(--dark-gray);
            font-size: 1rem;
            font-weight: 400;
        }

        .form-intro {
            background: var(--white);
            border-radius: 15px;
            padding: 2rem;
            margin: 2rem 0;
            box-shadow: 0 5px 20px rgba(233, 30, 99, 0.08);
        }

        .form-intro h2 {
            color: var(--primary-pink);
            margin-bottom: 0.5rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .progress-bar {
            height: 8px;
            background: var(--light-gray);
            border-radius: 4px;
            margin-top: 1.5rem;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--primary-pink), var(--soft-pink));
            width: 25%;
            transition: width 0.3s ease;
        }

        .form-section {
            background: var(--white);
            border-radius: 15px;
            padding: 2rem;
            margin-bottom: 2rem;
            box-shadow: 0 5px 20px rgba(233, 30, 99, 0.08);
            display: none;
        }

        .form-section.active {
            display: block;
            animation: fadeIn 0.5s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .form-section h3 {
            color: var(--dark-pink);
            margin-bottom: 1.5rem;
            padding-bottom: 0.5rem;
            border-bottom: 2px solid var(--light-pink);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1.5rem;
            margin-top: 1rem;
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-group.full-width {
            grid-column: 1 / -1;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            color: var(--dark-gray);
            font-weight: 500;
            font-size: 0.95rem;
        }

        .form-control {
            width: 100%;
            padding: 0.8rem 1rem;
            border: 2px solid var(--medium-gray);
            border-radius: 8px;
            font-family: 'Poppins', sans-serif;
            font-size: 1rem;
            transition: all 0.3s ease;
            background: var(--white);
        }

        .form-control:focus {
            outline: none;
            border-color: var(--primary-pink);
            box-shadow: 0 0 0 3px rgba(233, 30, 99, 0.1);
        }

        .yes-no .radio-group {
            display: flex;
            gap: 2rem;
            margin-top: 0.5rem;
            flex-wrap: wrap;
        }

        .radio-option {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            cursor: pointer;
            font-weight: 400;
        }

        .radio-option input[type="radio"] {
            display: none;
        }

        .radio-custom {
            width: 20px;
            height: 20px;
            border: 2px solid var(--medium-gray);
            border-radius: 50%;
            display: inline-block;
            position: relative;
            transition: all 0.3s ease;
        }

        .radio-option input[type="radio"]:checked + .radio-custom {
            border-color: var(--primary-pink);
            background: var(--primary-pink);
        }

        .radio-option input[type="radio"]:checked + .radio-custom::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 8px;
            height: 8px;
            background: var(--white);
            border-radius: 50%;
        }

        .conditional-group {
            margin-bottom: 1.5rem;
            padding: 1.2rem;
            background: var(--light-gray);
            border-radius: 10px;
        }

        .conditional-field {
            display: none;
            margin-top: 1rem;
            padding: 1.5rem;
            background: var(--light-pink);
            border-radius: 10px;
            border-left: 5px solid var(--primary-pink);
            animation: slideDown 0.3s ease;
        }

        .conditional-field.active {
            display: block;
        }

        @keyframes slideDown {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .checkbox-label {
            display: flex;
            align-items: flex-start;
            gap: 0.75rem;
            cursor: pointer;
            font-weight: 400;
        }

        .checkbox-label input[type="checkbox"] {
            display: none;
        }

        .checkmark {
            width: 24px;
            height: 24px;
            border: 2px solid var(--medium-gray);
            border-radius: 4px;
            display: inline-block;
            position: relative;
            flex-shrink: 0;
            transition: all 0.3s ease;
        }

        .checkbox-label input[type="checkbox"]:checked + .checkmark {
            background-color: var(--primary-pink);
            border-color: var(--primary-pink);
        }

        .checkbox-label input[type="checkbox"]:checked + .checkmark::after {
            content: '';
            position: absolute;
            left: 8px;
            top: 4px;
            width: 6px;
            height: 10px;
            border: solid white;
            border-width: 0 2px 2px 0;
            transform: rotate(45deg);
        }

        .signature-container {
            border: 2px solid var(--medium-gray);
            border-radius: 8px;
            padding: 1rem;
            background: var(--white);
            margin-bottom: 1rem;
        }

        #signatureCanvas {
            border: 1px solid var(--medium-gray);
            border-radius: 4px;
            cursor: crosshair;
            background: var(--white);
            width: 100%;
            max-width: 600px;
            height: 200px;
        }

        .form-navigation {
            display: flex;
            justify-content: space-between;
            gap: 1rem;
            margin-top: 2rem;
            padding-top: 2rem;
            border-top: 2px solid var(--light-pink);
        }

        .btn-primary, .btn-secondary, .btn-success {
            padding: 0.8rem 2rem;
            border: none;
            border-radius: 8px;
            font-family: 'Poppins', sans-serif;
            font-size: 1rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .btn-primary {
            background: var(--primary-pink);
            color: var(--white);
        }

        .btn-primary:hover {
            background: var(--dark-pink);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(233, 30, 99, 0.3);
        }

        .btn-secondary {
            background: var(--white);
            color: var(--primary-pink);
            border: 2px solid var(--primary-pink);
        }

        .btn-secondary:hover {
            background: var(--light-pink);
            transform: translateY(-2px);
        }

        .btn-success {
            background: var(--success-green);
            color: var(--white);
        }

        .btn-success:hover {
            background: #3d8b40;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(76, 175, 80, 0.3);
        }

        .loading-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(255, 255, 255, 0.9);
            z-index: 2000;
            justify-content: center;
            align-items: center;
        }

        .loading-overlay.active {
            display: flex;
        }

        .loading-content {
            text-align: center;
            background: var(--white);
            padding: 3rem;
            border-radius: 15px;
            box-shadow: 0 5px 30px rgba(0, 0, 0, 0.1);
        }

        .spinner {
            width: 50px;
            height: 50px;
            border: 4px solid var(--light-pink);
            border-top: 4px solid var(--primary-pink);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 1rem;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            z-index: 3000;
            justify-content: center;
            align-items: center;
            backdrop-filter: blur(3px);
        }

        .modal-overlay.active {
            display: flex;
        }

        .modal-content {
            background: var(--white);
            border-radius: 20px;
            padding: 3rem;
            max-width: 500px;
            width: 90%;
            text-align: center;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
            animation: modalSlideIn 0.4s ease;
        }

        @keyframes modalSlideIn {
            from { opacity: 0; transform: translateY(-30px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .modal-icon {
            font-size: 4rem;
            margin-bottom: 1.5rem;
        }

        .modal-icon.success {
            color: var(--success-green);
        }

        .modal-icon.error {
            color: var(--error-red);
        }

        .footer {
            background: linear-gradient(135deg, var(--dark-pink), var(--primary-pink));
            color: var(--white);
            padding: 3rem 0 2rem;
            margin-top: 3rem;
        }

        .footer-content {
            display: flex;
            flex-direction: column;
            gap: 2.5rem;
        }

        .footer-section {
            text-align: center;
        }

        .footer-section h4 {
            color: var(--white);
            font-size: 1.5rem;
            margin-bottom: 0.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
        }

        .footer-section p {
            color: rgba(255, 255, 255, 0.9);
            font-size: 1rem;
        }

        .footer-contact-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
            margin: 1rem 0;
        }

        .contact-item {
            display: flex;
            align-items: flex-start;
            gap: 1rem;
            padding: 1.2rem;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            transition: all 0.3s ease;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .contact-item:hover {
            transform: translateY(-3px);
            background: rgba(255, 255, 255, 0.15);
            border-color: rgba(255, 255, 255, 0.2);
        }

        .contact-icon {
            width: 45px;
            height: 45px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            color: var(--white);
        }

        .contact-info {
            display: flex;
            flex-direction: column;
            flex: 1;
        }

        .contact-label {
            font-size: 0.85rem;
            color: rgba(255, 255, 255, 0.8);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 0.25rem;
        }

        .contact-value {
            color: var(--white);
            font-weight: 500;
            font-size: 1rem;
            line-height: 1.4;
        }

        .footer-links {
            display: flex;
            justify-content: center;
            gap: 2rem;
            flex-wrap: wrap;
            padding-top: 1.5rem;
            border-top: 1px solid rgba(255, 255, 255, 0.2);
        }

        .footer-link {
            color: var(--white);
            text-decoration: none;
            font-weight: 500;
            padding: 0.5rem 1rem;
            border-radius: 6px;
            transition: all 0.3s ease;
        }

        .footer-link:hover {
            background: rgba(255, 255, 255, 0.1);
            transform: translateY(-2px);
        }

        .footer-bottom {
            text-align: center;
            padding-top: 2rem;
            margin-top: 2rem;
            border-top: 1px solid rgba(255, 255, 255, 0.3);
        }

        .footer-bottom p {
            color: rgba(255, 255, 255, 0.8);
            margin: 0.5rem 0;
        }

        .footer-credits {
            font-size: 0.85rem;
            color: rgba(255, 255, 255, 0.6) !important;
        }

        .form-control.error {
            border-color: var(--error-red);
            background: #fff5f5;
        }

        .form-control.success {
            border-color: var(--success-green);
            background: #f5fff5;
        }

        .error-message {
            color: var(--error-red);
            font-size: 0.875rem;
            margin-top: 0.25rem;
        }

        @media (max-width: 768px) {
            .form-grid {
                grid-template-columns: 1fr;
            }
            
            .logo-container {
                flex-direction: column;
                text-align: center;
            }
            
            .form-navigation {
                flex-direction: column;
            }
            
            .btn-primary, .btn-secondary, .btn-success {
                width: 100%;
                justify-content: center;
            }
            
            .footer-contact-grid {
                grid-template-columns: 1fr;
            }
            
            .footer-links {
                flex-direction: column;
                align-items: center;
                gap: 1rem;
            }
            
            .contact-item {
                padding: 1rem;
            }
            
            .modal-content {
                padding: 2rem 1.5rem;
                width: 95%;
            }
        }

        @media (max-width: 480px) {
            .form-intro, .form-section {
                padding: 1.5rem;
            }
            
            .yes-no .radio-group {
                flex-direction: column;
                gap: 1rem;
            }
        }
    </style>
</head>
<body>
    <header class="header">
        <div class="container">
            <div class="logo-container">
                <img src="https://via.placeholder.com/80x80/e91e63/ffffff?text=JNM" alt="Logo Dra. Jaqueline Nobre Moratore" class="logo">
                <div class="clinic-info">
                    <h1>Dra. Jaqueline Nobre Moratore</h1>
                    <p class="specialty">Odontologia Especializada</p>
                </div>
            </div>
        </div>
    </header>

    <main class="container">
        <div class="form-intro">
            <h2><i class="fas fa-file-medical"></i> Formulário de Anamnese Odontológica</h2>
            <p>Preencha todos os campos com informações precisas para um atendimento seguro e personalizado.</p>
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill"></div>
            </div>
        </div>

        <form id="anamneseForm" class="form-steps">
            
            <!-- Section 1: Personal Data -->
            <section class="form-section active" id="section-dados-pessoais">
                <h3><i class="fas fa-user"></i> Dados Pessoais</h3>
                <div class="form-grid">
                    <div class="form-group">
                        <label for="nome">Nome Completo *</label>
                        <input type="text" id="nome" name="nome" required class="form-control" placeholder="Digite seu nome completo">
                    </div>
                    
                    <div class="form-group">
                        <label for="data_nascimento">Data de Nascimento *</label>
                        <input type="date" id="data_nascimento" name="data_nascimento" required class="form-control">
                    </div>
                    
                    <div class="form-group">
                        <label for="genero">Gênero *</label>
                        <select id="genero" name="genero" required class="form-control">
                            <option value="">Selecione</option>
                            <option value="feminino">Feminino</option>
                            <option value="masculino">Masculino</option>
                            <option value="outro">Outro</option>
                            <option value="nao_informar">Prefiro não informar</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="telefone">Telefone *</label>
                        <input type="tel" id="telefone" name="telefone" required class="form-control" placeholder="(11) 99999-9999">
                    </div>
                    
                    <div class="form-group">
                        <label for="email">Email *</label>
                        <input type="email" id="email" name="email" required class="form-control" placeholder="seu.email@exemplo.com">
                    </div>
                    
                    <div class="form-group full-width">
                        <label for="endereco">Endereço Completo *</label>
                        <input type="text" id="endereco" name="endereco" required class="form-control" placeholder="Rua, número, bairro, cidade, estado">
                    </div>
                    
                    <div class="form-group">
                        <label for="profissao">Profissão</label>
                        <input type="text" id="profissao" name="profissao" class="form-control" placeholder="Sua profissão">
                    </div>
                    
                    <div class="form-group">
                        <label for="rg">RG</label>
                        <input type="text" id="rg" name="rg" class="form-control" placeholder="Número do RG">
                    </div>
                    
                    <div class="form-group">
                        <label for="cpf">CPF *</label>
                        <input type="text" id="cpf" name="cpf" required class="form-control" placeholder="000.000.000-00">
                    </div>
                </div>
            </section>

            <!-- Section 2: Health Evaluation -->
            <section class="form-section" id="section-avaliacao">
                <h3><i class="fas fa-heartbeat"></i> Avaliação de Saúde</h3>
                
                <!-- Tratamento Médico -->
                <div class="conditional-group" data-question="tratamento_medico">
                    <div class="form-group yes-no">
                        <label>Está em algum tratamento médico? *</label>
                        <div class="radio-group">
                            <label class="radio-option">
                                <input type="radio" name="tratamento_medico" value="sim" data-show="tratamento_medico_qual" required>
                                <span class="radio-custom"></span> Sim
                            </label>
                            <label class="radio-option">
                                <input type="radio" name="tratamento_medico" value="nao" data-hide="tratamento_medico_qual">
                                <span class="radio-custom"></span> Não
                            </label>
                        </div>
                    </div>
                    
                    <div class="conditional-field" id="tratamento_medico_qual">
                        <div class="form-group">
                            <label for="tratamento_medico_qual_texto">Qual tratamento?</label>
                            <input type="text" id="tratamento_medico_qual_texto" name="tratamento_medico_qual" class="form-control" placeholder="Descreva o tratamento">
                        </div>
                    </div>
                </div>

                <!-- Medicação -->
                <div class="conditional-group" data-question="medicacao">
                    <div class="form-group yes-no">
                        <label>Toma alguma medicação? *</label>
                        <div class="radio-group">
                            <label class="radio-option">
                                <input type="radio" name="medicacao" value="sim" data-show="medicacao_qual" required>
                                <span class="radio-custom"></span> Sim
                            </label>
                            <label class="radio-option">
                                <input type="radio" name="medicacao" value="nao" data-hide="medicacao_qual">
                                <span class="radio-custom"></span> Não
                            </label>
                        </div>
                    </div>
                    
                    <div class="conditional-field" id="medicacao_qual">
                        <div class="form-group">
                            <label for="medicacao_qual_texto">Qual medicação?</label>
                            <input type="text" id="medicacao_qual_texto" name="medicacao_qual" class="form-control" placeholder="Nome da medicação">
                        </div>
                    </div>
                </div>

                <!-- Cirurgia -->
                <div class="conditional-group" data-question="cirurgia">
                    <div class="form-group yes-no">
                        <label>Já se submeteu a alguma cirurgia? *</label>
                        <div class="radio-group">
                            <label class="radio-option">
                                <input type="radio" name="cirurgia" value="sim" data-show="cirurgia_qual" required>
                                <span class="radio-custom"></span> Sim
                            </label>
                            <label class="radio-option">
                                <input type="radio" name="cirurgia" value="nao" data-hide="cirurgia_qual">
                                <span class="radio-custom"></span> Não
                            </label>
                        </div>
                    </div>
                    
                    <div class="conditional-field" id="cirurgia_qual">
                        <div class="form-group">
                            <label for="cirurgia_qual_texto">Qual cirurgia?</label>
                            <input type="text" id="cirurgia_qual_texto" name="cirurgia_qual" class="form-control" placeholder="Tipo de cirurgia">
                        </div>
                    </div>
                </div>

                <!-- Anestesia Odontológica -->
                <div class="conditional-group" data-question="anestesia">
                    <div class="form-group yes-no">
                        <label>Já se submeteu a anestesia odontológica? *</label>
                        <div class="radio-group">
                            <label class="radio-option">
                                <input type="radio" name="anestesia" value="sim" data-show="anestesia_reacao" required>
                                <span class="radio-custom"></span> Sim
                            </label>
                            <label class="radio-option">
                                <input type="radio" name="anestesia" value="nao" data-hide="anestesia_reacao">
                                <span class="radio-custom"></span> Não
                            </label>
                        </div>
                    </div>
                    
                    <div class="conditional-field" id="anestesia_reacao">
                        <div class="form-group">
                            <label for="anestesia_reacao_texto">Teve alguma reação?</label>
                            <input type="text" id="anestesia_reacao_texto" name="anestesia_reacao" class="form-control" placeholder="Descreva a reação">
                        </div>
                    </div>
                </div>

                <!-- Alergia a Medicamentos -->
                <div class="conditional-group" data-question="alergia_medicamento">
                    <div class="form-group yes-no">
                        <label>Possui alergia a algum medicamento ou anestésico? *</label>
                        <div class="radio-group">
                            <label class="radio-option">
                                <input type="radio" name="alergia_medicamento" value="sim" data-show="alergia_medicamento_qual" required>
                                <span class="radio-custom"></span> Sim
                            </label>
                            <label class="radio-option">
                                <input type="radio" name="alergia_medicamento" value="nao" data-hide="alergia_medicamento_qual">
                                <span class="radio-custom"></span> Não
                            </label>
                        </div>
                    </div>
                    
                    <div class="conditional-field" id="alergia_medicamento_qual">
                        <div class="form-group">
                            <label for="alergia_medicamento_qual_texto">Qual medicamento/anestésico?</label>
                            <input type="text" id="alergia_medicamento_qual_texto" name="alergia_medicamento_qual" class="form-control" placeholder="Nome do medicamento">
                        </div>
                    </div>
                </div>

                <!-- Alergia a Alimentos -->
                <div class="conditional-group" data-question="alergia_alimento">
                    <div class="form-group yes-no">
                        <label>Possui alergia a algum alimento? *</label>
                        <div class="radio-group">
                            <label class="radio-option">
                                <input type="radio" name="alergia_alimento" value="sim" data-show="alergia_alimento_qual" required>
                                <span class="radio-custom"></span> Sim
                            </label>
                            <label class="radio-option">
                                <input type="radio" name="alergia_alimento" value="nao" data-hide="alergia_alimento_qual">
                                <span class="radio-custom"></span> Não
                            </label>
                        </div>
                    </div>
                    
                    <div class="conditional-field" id="alergia_alimento_qual">
                        <div class="form-group">
                            <label for="alergia_alimento_qual_texto">Qual alimento?</label>
                            <input type="text" id="alergia_alimento_qual_texto" name="alergia_alimento_qual" class="form-control" placeholder="Nome do alimento">
                        </div>
                    </div>
                </div>

                <!-- Alteração Cardiológica -->
                <div class="form-group yes-no">
                    <label>Possui alguma alteração cardiológica? *</label>
                    <div class="radio-group">
                        <label class="radio-option">
                            <input type="radio" name="alteracao_cardiologica" value="sim" required>
                            <span class="radio-custom"></span> Sim
                        </label>
                        <label class="radio-option">
                            <input type="radio" name="alteracao_cardiologica" value="nao">
                            <span class="radio-custom"></span> Não
                        </label>
                    </div>
                </div>

                <!-- Diabético -->
                <div class="form-group yes-no">
                    <label>É diabético? *</label>
                    <div class="radio-group">
                        <label class="radio-option">
                            <input type="radio" name="diabetico" value="sim" required>
                            <span class="radio-custom"></span> Sim
                        </label>
                        <label class="radio-option">
                            <input type="radio" name="diabetico" value="nao">
                            <span class="radio-custom"></span> Não
                        </label>
                    </div>
                </div>

                <!-- Convulsões/Epilepsia -->
                <div class="form-group yes-no">
                    <label>Tem convulsões ou epilepsia? *</label>
                    <div class="radio-group">
                        <label class="radio-option">
                            <input type="radio" name="convulsoes" value="sim" required>
                            <span class="radio-custom"></span> Sim
                        </label>
                        <label class="radio-option">
                            <input type="radio" name="convulsoes" value="nao">
                            <span class="radio-custom"></span> Não
                        </label>
                    </div>
                </div>

                <!-- Disfunção Renal -->
                <div class="conditional-group" data-question="disfuncao_renal">
                    <div class="form-group yes-no">
                        <label>Tem alguma disfunção renal? *</label>
                        <div class="radio-group">
                            <label class="radio-option">
                                <input type="radio" name="disfuncao_renal" value="sim" data-show="disfuncao_renal_qual" required>
                                <span class="radio-custom"></span> Sim
                            </label>
                            <label class="radio-option">
                                <input type="radio" name="disfuncao_renal" value="nao" data-hide="disfuncao_renal_qual">
                                <span class="radio-custom"></span> Não
                            </label>
                        </div>
                    </div>
                    
                    <div class="conditional-field" id="disfuncao_renal_qual">
                        <div class="form-group">
                            <label for="disfuncao_renal_qual_texto">Qual disfunção renal?</label>
                            <input type="text" id="disfuncao_renal_qual_texto" name="disfuncao_renal_qual" class="form-control" placeholder="Descreva a disfunção renal">
                        </div>
                    </div>
                </div>

                <!-- Coagulação Sanguínea -->
                <div class="form-group yes-no">
                    <label>Tem problemas de coagulação sanguínea? *</label>
                    <div class="radio-group">
                        <label class="radio-option">
                            <input type="radio" name="coagulacao" value="sim" required>
                            <span class="radio-custom"></span> Sim
                        </label>
                        <label class="radio-option">
                            <input type="radio" name="coagulacao" value="nao">
                            <span class="radio-custom"></span> Não
                        </label>
                    </div>
                </div>

                <!-- Grávida ou Lactante -->
                <div class="form-group yes-no">
                    <label>Grávida ou lactante? *</label>
                    <div class="radio-group">
                        <label class="radio-option">
                            <input type="radio" name="gravida_lactante" value="sim" required>
                            <span class="radio-custom"></span> Sim
                        </label>
                        <label class="radio-option">
                            <input type="radio" name="gravida_lactante" value="nao">
                            <span class="radio-custom"></span> Não
                        </label>
                        <label class="radio-option">
                            <input type="radio" name="gravida_lactante" value="nao_se_aplica">
                            <span class="radio-custom"></span> Não se aplica
                        </label>
                    </div>
                </div>

                <!-- Problema Hormonal -->
                <div class="conditional-group" data-question="problema_hormonal">
                    <div class="form-group yes-no">
                        <label>Possui algum problema hormonal? *</label>
                        <div class="radio-group">
                            <label class="radio-option">
                                <input type="radio" name="problema_hormonal" value="sim" data-show="problema_hormonal_qual" required>
                                <span class="radio-custom"></span> Sim
                            </label>
                            <label class="radio-option">
                                <input type="radio" name="problema_hormonal" value="nao" data-hide="problema_hormonal_qual">
                                <span class="radio-custom"></span> Não
                            </label>
                        </div>
                    </div>
                    
                    <div class="conditional-field" id="problema_hormonal_qual">
                        <div class="form-group">
                            <label for="problema_hormonal_qual_texto">Qual problema hormonal?</label>
                            <input type="text" id="problema_hormonal_qual_texto" name="problema_hormonal_qual" class="form-control" placeholder="Descreva o problema hormonal">
                        </div>
                    </div>
                </div>

                <!-- Alergia a Cosméticos -->
                <div class="conditional-group" data-question="alergia_cosmeticos">
                    <div class="form-group yes-no">
                        <label>Possui alergia a produtos cosméticos? *</label>
                        <div class="radio-group">
                            <label class="radio-option">
                                <input type="radio" name="alergia_cosmeticos" value="sim" data-show="alergia_cosmeticos_qual" required>
                                <span class="radio-custom"></span> Sim
                            </label>
                            <label class="radio-option">
                                <input type="radio" name="alergia_cosmeticos" value="nao" data-hide="alergia_cosmeticos_qual">
                                <span class="radio-custom"></span> Não
                            </label>
                        </div>
                    </div>
                    
                    <div class="conditional-field" id="alergia_cosmeticos_qual">
                        <div class="form-group">
                            <label for="alergia_cosmeticos_qual_texto">Qual produto cosmético?</label>
                            <input type="text" id="alergia_cosmeticos_qual_texto" name="alergia_cosmeticos_qual" class="form-control" placeholder="Nome do produto cosmético">
                        </div>
                    </div>
                </div>

                <!-- Autorização de Imagem -->
                <div class="form-group yes-no">
                    <label>Você autoriza uso de imagem? *</label>
                    <div class="radio-group">
                        <label class="radio-option">
                            <input type="radio" name="autoriza_imagem" value="sim" required>
                            <span class="radio-custom"></span> Sim
                        </label>
                        <label class="radio-option">
                            <input type="radio" name="autoriza_imagem" value="nao">
                            <span class="radio-custom"></span> Não
                        </label>
                    </div>
                </div>

                <!-- Preferência Musical -->
                <div class="conditional-group" data-question="musica">
                    <div class="form-group yes-no">
                        <label>Tem preferência por algum tipo de música? *</label>
                        <div class="radio-group">
                            <label class="radio-option">
                                <input type="radio" name="prefere_musica" value="sim" data-show="musica_qual" required>
                                <span class="radio-custom"></span> Sim
                            </label>
                            <label class="radio-option">
                                <input type="radio" name="prefere_musica" value="nao" data-hide="musica_qual">
                                <span class="radio-custom"></span> Não
                            </label>
                        </div>
                    </div>
                    
                    <div class="conditional-field" id="musica_qual">
                        <div class="form-group">
                            <label for="musica_qual_texto">Qual tipo de música?</label>
                            <input type="text" id="musica_qual_texto" name="musica_qual" class="form-control" placeholder="Ex: Clássica, Jazz, Pop">
                        </div>
                    </div>
                </div>
            </section>

            <!-- Section 3: Oral Habits -->
            <section class="form-section" id="section-habitos">
                <h3><i class="fas fa-tooth"></i> Hábitos Orais</h3>
                
                <div class="form-group">
                    <label for="frequencia_escovacao">Com qual frequência você escova os dentes? *</label>
                    <select id="frequencia_escovacao" name="frequencia_escovacao" required class="form-control">
                        <option value="">Selecione</option>
                        <option value="1_vez_dia">1 vez ao dia</option>
                        <option value="2_vezes_dia">2 vezes ao dia</option>
                        <option value="3_vezes_dia">3 vezes ao dia</option>
                        <option value="mais_3_vezes">Mais de 3 vezes ao dia</option>
                        <option value="as_vezes">Às vezes esqueço</option>
                    </select>
                </div>
                
                <div class="form-group yes-no">
                    <label>Faz uso de fio dental? *</label>
                    <div class="radio-group">
                        <label class="radio-option">
                            <input type="radio" name="fio_dental" value="sim" required>
                            <span class="radio-custom"></span> Sim
                        </label>
                        <label class="radio-option">
                            <input type="radio" name="fio_dental" value="nao">
                            <span class="radio-custom"></span> Não
                        </label>
                        <label class="radio-option">
                            <input type="radio" name="fio_dental" value="as_vezes">
                            <span class="radio-custom"></span> Às vezes
                        </label>
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="creme_dental">Qual creme dental usa?</label>
                    <input type="text" id="creme_dental" name="creme_dental" class="form-control" placeholder="Ex: Colgate Total 12, Sensodyne">
                </div>
                
                <div class="form-group yes-no">
                    <label>Escova regularmente a língua? *</label>
                    <div class="radio-group">
                        <label class="radio-option">
                            <input type="radio" name="escova_lingua" value="sim" required>
                            <span class="radio-custom"></span> Sim
                        </label>
                        <label class="radio-option">
                            <input type="radio" name="escova_lingua" value="nao">
                            <span class="radio-custom"></span> Não
                        </label>
                        <label class="radio-option">
                            <input type="radio" name="escova_lingua" value="as_vezes">
                            <span class="radio-custom"></span> Às vezes
                        </label>
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="marca_escova">Qual a marca da sua escova?</label>
                    <input type="text" id="marca_escova" name="marca_escova" class="form-control" placeholder="Ex: Oral-B, Colgate">
                </div>
                
                <div class="form-group yes-no">
                    <label>Morde objetos? *</label>
                    <div class="radio-group">
                        <label class="radio-option">
                            <input type="radio" name="morde_objetos" value="sim" required>
                            <span class="radio-custom"></span> Sim
                        </label>
                        <label class="radio-option">
                            <input type="radio" name="morde_objetos" value="nao">
                            <span class="radio-custom"></span> Não
                        </label>
                    </div>
                </div>
                
                <div class="form-group yes-no">
                    <label>Range os dentes? *</label>
                    <div class="radio-group">
                        <label class="radio-option">
                            <input type="radio" name="range_dentes" value="sim" required>
                            <span class="radio-custom"></span> Sim
                        </label>
                        <label class="radio-option">
                            <input type="radio" name="range_dentes" value="nao">
                            <span class="radio-custom"></span> Não
                        </label>
                        <label class="radio-option">
                            <input type="radio" name="range_dentes" value="nao_sei">
                            <span class="radio-custom"></span> Não sei
                        </label>
                    </div>
                </div>
                
                <div class="form-group yes-no">
                    <label>Rói as unhas? *</label>
                    <div class="radio-group">
                        <label class="radio-option">
                            <input type="radio" name="roi_unhas" value="sim" required>
                            <span class="radio-custom"></span> Sim
                        </label>
                        <label class="radio-option">
                            <input type="radio" name="roi_unhas" value="nao">
                            <span class="radio-custom"></span> Não
                        </label>
                    </div>
                </div>
            </section>

            <!-- Section 4: Signature & Consent -->
            <section class="form-section" id="section-assinatura">
                <h3><i class="fas fa-signature"></i> Validação e Assinatura</h3>
                
                <div class="consent-box">
                    <div class="form-group">
                        <label class="checkbox-label">
                            <input type="checkbox" id="consentimento" name="consentimento" required>
                            <span class="checkmark"></span>
                            Declaro que as informações fornecidas são verdadeiras e autorizo seu uso para fins de tratamento odontológico.
                        </label>
                    </div>
                    
                    <div class="form-group">
                        <label for="assinatura_eletronica">Assinatura Eletrônica *</label>
                        <div class="signature-container">
                            <canvas id="signatureCanvas" width="600" height="200"></canvas>
                            <button type="button" id="clearSignature" class="btn-secondary">
                                <i class="fas fa-eraser"></i> Limpar Assinatura
                            </button>
                        </div>
                        <input type="hidden" id="assinatura_eletronica" name="assinatura_eletronica">
                    </div>
                    
                    <div class="form-group">
                        <label for="data_preenchimento">Data do Preenchimento</label>
                        <input type="text" id="data_preenchimento" name="data_preenchimento" class="form-control" readonly value="">
                    </div>
                </div>
            </section>

            <!-- Navigation Buttons -->
            <div class="form-navigation">
                <button type="button" id="prevBtn" class="btn-secondary">
                    <i class="fas fa-arrow-left"></i> Anterior
                </button>
                <button type="button" id="nextBtn" class="btn-primary">
                    Próximo <i class="fas fa-arrow-right"></i>
                </button>
                <button type="submit" id="submitBtn" class="btn-success">
                    <i class="fas fa-paper-plane"></i> Enviar Formulário
                </button>
            </div>
        </form>

        <!-- Loading Indicator -->
        <div id="loadingIndicator" class="loading-overlay">
            <div class="loading-content">
                <div class="spinner"></div>
                <p>Gerando PDF e enviando por email...</p>
                <p class="footer-credits">Isso pode levar alguns segundos</p>
            </div>
        </div>
    </main>

    <!-- Success Modal -->
    <div id="successModal" class="modal-overlay">
        <div class="modal-content">
            <div class="modal-icon success">
                <i class="fas fa-check-circle"></i>
            </div>
            <h3>Formulário Enviado com Sucesso!</h3>
            <p>Seu formulário foi processado com sucesso.</p>
            <p>Um PDF foi gerado e enviado para seu email.</p>
            <p class="footer-credits">Verifique sua caixa de entrada e spam</p>
            <button id="closeModal" class="btn-primary">OK</button>
        </div>
    </div>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <div class="footer-section">
                    <h4><i class="fas fa-tooth"></i> Dra. Jaqueline Nobre Moratore</h4>
                    <p>Odontologia Especializada com Excelência e Cuidado</p>
                </div>
                
                <div class="footer-contact-grid">
                    <div class="contact-item">
                        <div class="contact-icon">
                            <i class="fas fa-phone-alt"></i>
                        </div>
                        <div class="contact-info">
                            <span class="contact-label">Telefone</span>
                            <span class="contact-value">(11) 99999-9999</span>
                        </div>
                    </div>
                    
                    <div class="contact-item">
                        <div class="contact-icon">
                            <i class="fas fa-envelope"></i>
                        </div>
                        <div class="contact-info">
                            <span class="contact-label">Email</span>
                            <span class="contact-value">contato@drajaqueline.com</span>
                        </div>
                    </div>
                    
                    <div class="contact-item">
                        <div class="contact-icon">
                            <i class="fas fa-clock"></i>
                        </div>
                        <div class="contact-info">
                            <span class="contact-label">Horário</span>
                            <span class="contact-value">Seg-Sex: 8h-18h</span>
                            <span class="contact-value">Sáb: 8h-12h</span>
                        </div>
                    </div>
                    
                    <div class="contact-item">
                        <div class="contact-icon">
                            <i class="fas fa-map-marker-alt"></i>
                        </div>
                        <div class="contact-info">
                            <span class="contact-label">Endereço</span>
                            <span class="contact-value">Av. Paulista, 1000</span>
                            <span class="contact-value">São Paulo - SP</span>
                        </div>
                    </div>
                </div>
                
                <div class="footer-links">
                    <a href="#" class="footer-link">Política de Privacidade</a>
                    <a href="#" class="footer-link">Termos de Uso</a>
                    <a href="#" class="footer-link">Agendar Consulta</a>
                </div>
            </div>
            
            <div class="footer-bottom">
                <p>© 2024 Dra. Jaqueline Nobre Moratore - Todos os direitos reservados</p>
                <p class="footer-credits">Formulário desenvolvido com tecnologia segura e confiável</p>
            </div>
        </div>
    </footer>

    <script>
        class AnamneseForm {
            constructor() {
                this.currentStep = 0;
                this.formSections = document.querySelectorAll('.form-section');
                this.progressFill = document.getElementById('progressFill');
                this.form = document.getElementById('anamneseForm');
                this.signatureCanvas = document.getElementById('signatureCanvas');
                this.ctx = this.signatureCanvas.getContext('2d');
                this.isDrawing = false;
                this.lastX = 0;
                this.lastY = 0;
                
                // URL DO GOOGLE APPS SCRIPT - SUBSTITUA POR SUA URL
                this.GAS_URL = 'https://script.google.com/macros/s/AKfycbzzXv41bMDbk4Z_bxpLR0INh_ypgSUZeUWepr0S4R1EDjzUZ7P-IFHBg08DU1kkwPKE/exec';
                
                this.init();
            }
            
            init() {
                this.setCurrentDate();
                this.initSignatureCanvas();
                this.showSection(0);
                this.addEventListeners();
                this.initConditionalQuestions();
                this.setupRealTimeValidation();
            }
            
            setCurrentDate() {
                const now = new Date();
                const formattedDate = now.toLocaleDateString('pt-BR', {
                    day: '2-digit',
                    month: '2-digit',
                    year: 'numeric'
                });
                document.getElementById('data_preenchimento').value = formattedDate;
            }
            
            initSignatureCanvas() {
                this.ctx.fillStyle = '#ffffff';
                this.ctx.fillRect(0, 0, this.signatureCanvas.width, this.signatureCanvas.height);
                this.ctx.lineWidth = 2;
                this.ctx.lineCap = 'round';
                this.ctx.strokeStyle = '#000000';
                
                // Mouse events
                this.signatureCanvas.addEventListener('mousedown', (e) => this.startDrawing(e));
                this.signatureCanvas.addEventListener('mousemove', (e) => this.draw(e));
                this.signatureCanvas.addEventListener('mouseup', () => this.stopDrawing());
                this.signatureCanvas.addEventListener('mouseout', () => this.stopDrawing());
                
                // Touch events
                this.signatureCanvas.addEventListener('touchstart', (e) => {
                    e.preventDefault();
                    this.startDrawing(e.touches[0]);
                });
                
                this.signatureCanvas.addEventListener('touchmove', (e) => {
                    e.preventDefault();
                    this.draw(e.touches[0]);
                });
                
                this.signatureCanvas.addEventListener('touchend', () => this.stopDrawing());
                
                // Clear button
                document.getElementById('clearSignature').addEventListener('click', () => this.clearSignature());
            }
            
            startDrawing(e) {
                const rect = this.signatureCanvas.getBoundingClientRect();
                this.isDrawing = true;
                [this.lastX, this.lastY] = [
                    e.clientX - rect.left,
                    e.clientY - rect.top
                ];
            }
            
            draw(e) {
                if (!this.isDrawing) return;
                
                const rect = this.signatureCanvas.getBoundingClientRect();
                const x = e.clientX - rect.left;
                const y = e.clientY - rect.top;
                
                this.ctx.beginPath();
                this.ctx.moveTo(this.lastX, this.lastY);
                this.ctx.lineTo(x, y);
                this.ctx.stroke();
                
                [this.lastX, this.lastY] = [x, y];
            }
            
            stopDrawing() {
                this.isDrawing = false;
                this.saveSignature();
            }
            
            saveSignature() {
                const signatureData = this.signatureCanvas.toDataURL('image/png');
                document.getElementById('assinatura_eletronica').value = signatureData;
            }
            
            clearSignature() {
                this.ctx.fillStyle = '#ffffff';
                this.ctx.fillRect(0, 0, this.signatureCanvas.width, this.signatureCanvas.height);
                document.getElementById('assinatura_eletronica').value = '';
            }
            
            initConditionalQuestions() {
                const radioGroups = document.querySelectorAll('input[type="radio"][data-show], input[type="radio"][data-hide]');
                
                radioGroups.forEach(radio => {
                    radio.addEventListener('change', (e) => {
                        this.handleConditionalField(e.target);
                    });
                    
                    if (radio.checked) {
                        this.handleConditionalField(radio);
                    }
                });
            }
            
            handleConditionalField(radio) {
                const showId = radio.dataset.show;
                const hideId = radio.dataset.hide;
                
                if (showId && radio.value === 'sim') {
                    const field = document.getElementById(showId);
                    if (field) {
                        field.classList.add('active');
                        const input = field.querySelector('input, textarea, select');
                        if (input) input.required = true;
                    }
                }
                
                if (hideId && radio.value === 'nao') {
                    const field = document.getElementById(hideId);
                    if (field) {
                        field.classList.remove('active');
                        const input = field.querySelector('input, textarea, select');
                        if (input) {
                            input.required = false;
                            input.value = '';
                        }
                    }
                }
            }
            
            setupRealTimeValidation() {
                // CPF formatting
                const cpfInput = document.getElementById('cpf');
                if (cpfInput) {
                    cpfInput.addEventListener('input', (e) => {
                        let value = e.target.value.replace(/\D/g, '');
                        if (value.length > 11) value = value.substring(0, 11);
                        
                        if (value.length <= 11) {
                            value = value.replace(/(\d{3})(\d)/, '$1.$2');
                            value = value.replace(/(\d{3})(\d)/, '$1.$2');
                            value = value.replace(/(\d{3})(\d{1,2})$/, '$1-$2');
                        }
                        
                        e.target.value = value;
                    });
                }
                
                // Phone formatting
                const phoneInput = document.getElementById('telefone');
                if (phoneInput) {
                    phoneInput.addEventListener('input', (e) => {
                        let value = e.target.value.replace(/\D/g, '');
                        if (value.length <= 10) {
                            value = value.replace(/(\d{2})(\d)/, '($1) $2');
                            value = value.replace(/(\d{4})(\d)/, '$1-$2');
                        } else if (value.length <= 11) {
                            value = value.replace(/(\d{2})(\d)/, '($1) $2');
                            value = value.replace(/(\d{5})(\d)/, '$1-$2');
                        }
                        e.target.value = value.substring(0, 15);
                    });
                }
            }
            
            showSection(n) {
                this.formSections.forEach(section => {
                    section.classList.remove('active');
                });
                
                this.formSections[n].classList.add('active');
                
                const progress = ((n + 1) / this.formSections.length) * 100;
                this.progressFill.style.width = `${progress}%`;
                
                this.updateNavigationButtons(n);
            }
            
            updateNavigationButtons(n) {
                const prevBtn = document.getElementById('prevBtn');
                const nextBtn = document.getElementById('nextBtn');
                const submitBtn = document.getElementById('submitBtn');
                
                prevBtn.style.display = n === 0 ? 'none' : 'flex';
                nextBtn.style.display = n === this.formSections.length - 1 ? 'none' : 'flex';
                submitBtn.style.display = n === this.formSections.length - 1 ? 'flex' : 'none';
            }
            
            validateCurrentSection() {
                const currentSection = this.formSections[this.currentStep];
                const inputs = currentSection.querySelectorAll('input[required], select[required]');
                let isValid = true;
                
                for (let input of inputs) {
                    if (!input.value.trim()) {
                        input.focus();
                        input.classList.add('error');
                        this.showError(input, 'Este campo é obrigatório');
                        isValid = false;
                    } else {
                        input.classList.remove('error');
                        this.removeError(input);
                        
                        if (input.type === 'email') {
                            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
                            if (!emailRegex.test(input.value)) {
                                input.classList.add('error');
                                this.showError(input, 'Email inválido');
                                isValid = false;
                            }
                        }
                        
                        if (input.id === 'cpf') {
                            const cpf = input.value.replace(/\D/g, '');
                            if (cpf.length === 11 && !this.validateCPF(cpf)) {
                                input.classList.add('error');
                                this.showError(input, 'CPF inválido');
                                isValid = false;
                            }
                        }
                    }
                }
                
                return isValid;
            }
            
            showError(input, message) {
                this.removeError(input);
                
                const error = document.createElement('div');
                error.className = 'error-message';
                error.textContent = message;
                error.style.color = 'var(--error-red)';
                error.style.fontSize = '0.875rem';
                error.style.marginTop = '0.25rem';
                
                input.parentNode.appendChild(error);
            }
            
            removeError(input) {
                const error = input.parentNode.querySelector('.error-message');
                if (error) error.remove();
            }
            
            validateCPF(cpf) {
                if (cpf.length !== 11) return false;
                
                // Elimina CPFs inválidos conhecidos
                if (/^(\d)\1{10}$/.test(cpf)) return false;
                
                let sum = 0;
                for (let i = 0; i < 9; i++) {
                    sum += parseInt(cpf.charAt(i)) * (10 - i);
                }
                let remainder = sum % 11;
                let digit1 = remainder < 2 ? 0 : 11 - remainder;
                
                if (digit1 !== parseInt(cpf.charAt(9))) return false;
                
                sum = 0;
                for (let i = 0; i < 10; i++) {
                    sum += parseInt(cpf.charAt(i)) * (11 - i);
                }
                remainder = sum % 11;
                let digit2 = remainder < 2 ? 0 : 11 - remainder;
                
                return digit2 === parseInt(cpf.charAt(10));
            }
            
            collectFormData() {
                const formData = new FormData(this.form);
                const data = {};
                
                for (let [key, value] of formData.entries()) {
                    if (value && value !== 'on') {
                        data[key] = value.trim();
                    } else if (value === 'on') {
                        data[key] = true;
                    }
                }
                
                // Adicionar metadados
                data.timestamp = new Date().toISOString();
                data.submission_date = new Date().toLocaleDateString('pt-BR');
                
                // Criar nome do arquivo
                const date = new Date();
                const formattedDate = `${date.getDate().toString().padStart(2, '0')}-${
                    (date.getMonth() + 1).toString().padStart(2, '0')}-${
                    date.getFullYear()}`;
                
                const nomeArquivo = `Anamnese_${data.nome.replace(/\s+/g, '_')}_${data.cpf.replace(/\D/g, '').substring(0, 11)}_${formattedDate}.pdf`;
                data.filename = nomeArquivo;
                
                return data;
            }
            
            async submitForm() {
                // Validar seção atual
                if (!this.validateCurrentSection()) {
                    alert('Por favor, corrija os erros no formulário.');
                    return;
                }
                
                // Validar assinatura
                const signature = document.getElementById('assinatura_eletronica').value;
                if (!signature) {
                    alert('Por favor, forneça sua assinatura eletrônica.');
                    return;
                }
                
                // Validar consentimento
                const consentimento = document.getElementById('consentimento');
                if (!consentimento.checked) {
                    alert('Você precisa concordar com os termos para enviar o formulário.');
                    consentimento.focus();
                    return;
                }
                
                // Mostrar loading
                this.showLoading(true);
                
                try {
                    const formData = this.collectFormData();
                    console.log('📤 Enviando dados:', formData);
                    
                    // MÉTODO CORRETO: Usar Google Apps Script como endpoint
                    const response = await this.sendToGoogleAppsScript(formData);
                    
                    console.log('✅ Resposta recebida:', response);
                    
                    if (response.success) {
                        this.showSuccessModal();
                        
                        // Resetar formulário após 3 segundos
                        setTimeout(() => {
                            this.resetForm();
                        }, 3000);
                    } else {
                        throw new Error(response.message || 'Erro no processamento');
                    }
                    
                } catch (error) {
                    console.error('❌ Erro ao enviar:', error);
                    
                    // Tentar método alternativo
                    try {
                        console.log('🔄 Tentando método alternativo...');
                        await this.sendViaProxy(formData);
                    } catch (error2) {
                        console.error('❌ Método alternativo falhou:', error2);
                        this.showErrorModal(`Erro: ${error.message}. Por favor, tente novamente mais tarde ou entre em contato.`);
                    }
                } finally {
                    this.showLoading(false);
                }
            }
            
            // MÉTODO PRINCIPAL: Enviar para Google Apps Script
            async sendToGoogleAppsScript(data) {
                return new Promise((resolve, reject) => {
                    const xhr = new XMLHttpRequest();
                    const url = this.GAS_URL;
                    
                    console.log(`📡 Enviando para: ${url}`);
                    
                    xhr.open('POST', url, true);
                    xhr.setRequestHeader('Content-Type', 'application/json');
                    
                    xhr.onreadystatechange = () => {
                        if (xhr.readyState === 4) {
                            console.log(`📥 Resposta recebida - Status: ${xhr.status}`);
                            
                            try {
                                if (xhr.status === 0) {
                                    // Google Apps Script pode retornar status 0 em alguns casos
                                    console.log('⚠️ Status 0 (possível CORS), verificando resposta...');
                                }
                                
                                if (xhr.responseText) {
                                    const response = JSON.parse(xhr.responseText);
                                    resolve(response);
                                } else {
                                    // Se não há resposta, considerar como sucesso
                                    resolve({
                                        success: true,
                                        message: 'Formulário enviado (resposta vazia)',
                                        timestamp: new Date().toISOString()
                                    });
                                }
                            } catch (parseError) {
                                console.error('❌ Erro ao parsear resposta:', parseError);
                                console.log('Resposta bruta:', xhr.responseText);
                                
                                // Tentar interpretar como sucesso mesmo com erro de parse
                                if (xhr.responseText && xhr.responseText.includes('success')) {
                                    resolve({
                                        success: true,
                                        message: 'Formulário processado (resposta mal formatada)',
                                        rawResponse: xhr.responseText.substring(0, 100)
                                    });
                                } else {
                                    reject(new Error(`Resposta inválida: ${xhr.responseText}`));
                                }
                            }
                        }
                    };
                    
                    xhr.onerror = () => {
                        console.error('❌ Erro de rede no XHR');
                        reject(new Error('Erro de conexão com o servidor'));
                    };
                    
                    xhr.ontimeout = () => {
                        console.error('⏱️ Timeout no XHR');
                        reject(new Error('Tempo esgotado na conexão'));
                    };
                    
                    xhr.timeout = 45000; // 45 segundos
                    
                    // Enviar dados
                    xhr.send(JSON.stringify(data));
                });
            }
            
            // MÉTODO ALTERNATIVO: Usar proxy CORS
            async sendViaProxy(data) {
                // Usar um proxy CORS público
                const proxyUrl = 'https://cors-anywhere.herokuapp.com/';
                const targetUrl = this.GAS_URL;
                
                const response = await fetch(proxyUrl + targetUrl, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-Requested-With': 'XMLHttpRequest'
                    },
                    body: JSON.stringify(data)
                });
                
                if (!response.ok) {
                    throw new Error(`Proxy error: ${response.status}`);
                }
                
                const result = await response.json();
                return result;
            }
            
            showLoading(show) {
                const loadingIndicator = document.getElementById('loadingIndicator');
                if (show) {
                    loadingIndicator.classList.add('active');
                } else {
                    loadingIndicator.classList.remove('active');
                }
            }
            
            showSuccessModal() {
                const modal = document.getElementById('successModal');
                modal.classList.add('active');
                
                document.getElementById('closeModal').onclick = () => {
                    modal.classList.remove('active');
                };
                
                modal.onclick = (e) => {
                    if (e.target === modal) {
                        modal.classList.remove('active');
                    }
                };
            }
            
            showErrorModal(message) {
                const modal = document.createElement('div');
                modal.className = 'modal-overlay active';
                modal.innerHTML = `
                    <div class="modal-content">
                        <div class="modal-icon error">
                            <i class="fas fa-exclamation-circle"></i>
                        </div>
                        <h3>Erro no Envio</h3>
                        <p>${message}</p>
                        <p style="font-size: 14px; color: #666; margin-top: 10px;">
                            Você pode tentar novamente ou entrar em contato diretamente.
                        </p>
                        <button class="btn-primary" id="closeErrorModal">OK</button>
                    </div>
                `;
                
                document.body.appendChild(modal);
                
                document.getElementById('closeErrorModal').onclick = () => {
                    modal.remove();
                };
                
                modal.onclick = (e) => {
                    if (e.target === modal) {
                        modal.remove();
                    }
                };
            }
            
            resetForm() {
                this.form.reset();
                this.clearSignature();
                this.currentStep = 0;
                this.showSection(0);
                this.setCurrentDate();
                
                document.querySelectorAll('.conditional-field').forEach(field => {
                    field.classList.remove('active');
                });
                
                document.querySelectorAll('.error, .success').forEach(el => {
                    el.classList.remove('error', 'success');
                });
                
                document.querySelectorAll('.error-message').forEach(el => el.remove());
            }
            
            addEventListeners() {
                document.getElementById('nextBtn').addEventListener('click', () => {
                    if (this.validateCurrentSection()) {
                        this.currentStep++;
                        this.showSection(this.currentStep);
                    }
                });
                
                document.getElementById('prevBtn').addEventListener('click', () => {
                    this.currentStep--;
                    this.showSection(this.currentStep);
                });
                
                this.form.addEventListener('submit', (e) => {
                    e.preventDefault();
                    this.submitForm();
                });
            }
        }
        
        // Inicializar quando o DOM estiver carregado
        document.addEventListener('DOMContentLoaded', () => {
            new AnamneseForm();
            
            // Adicionar botão de teste (apenas para desenvolvimento)
            if (window.location.hostname === 'localhost' || window.location.hostname.includes('github.io')) {
                const testButton = document.createElement('button');
                testButton.innerHTML = '🔧 Testar Conexão';
                testButton.style.position = 'fixed';
                testButton.style.bottom = '20px';
                testButton.style.right = '20px';
                testButton.style.zIndex = '9999';
                testButton.style.padding = '10px 15px';
                testButton.style.background = '#e91e63';
                testButton.style.color = 'white';
                testButton.style.border = 'none';
                testButton.style.borderRadius = '5px';
                testButton.style.cursor = 'pointer';
                testButton.style.fontSize = '12px';
                
                testButton.onclick = async () => {
                    const testData = {
                        nome: "Teste de Conexão",
                        email: "teste@exemplo.com",
                        cpf: "123.456.789-09",
                        telefone: "(11) 99999-9999",
                        data_nascimento: "2000-01-01",
                        genero: "masculino",
                        endereco: "Endereço teste",
                        consentimento: true,
                        data_preenchimento: new Date().toLocaleDateString('pt-BR'),
                        filename: "Teste_Conexao.pdf"
                    };
                    
                    alert('Testando conexão com Google Apps Script...\nVerifique o console (F12)');
                    
                    try {
                        const form = new AnamneseForm();
                        const response = await form.sendToGoogleAppsScript(testData);
                        console.log('✅ Teste bem-sucedido:', response);
                        alert(`✅ Conexão OK!\n${response.message}`);
                    } catch (error) {
                        console.error('❌ Teste falhou:', error);
                        alert(`❌ Falha na conexão:\n${error.message}`);
                    }
                };
                
                document.body.appendChild(testButton);
            }
        });
    </script>
</body>
</html>
